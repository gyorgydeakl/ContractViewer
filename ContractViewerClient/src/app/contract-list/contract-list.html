<div class="flex flex-wrap justify-between items-end gap-3 mb-4">
  <h1 class="text-2xl font-bold opacity-80">Contracts for {{ auth.token() }}</h1>
  <p-button label="Refresh" icon="pi pi-refresh" [outlined]="true" (onClick)="reload()"/>
</div>

@if (contracts.isLoading()) {
  <div class="flex items-center justify-center py-10">
    <p-progress-spinner aria-label="Loading contracts"></p-progress-spinner>
  </div>
} @else if (!contracts.hasValue()) {
  <div class="flex flex-col items-center gap-4 py-10">
    <p>Failed to fetch contracts</p>
  </div>
} @else {
  <!-- Search -->
  <div class="flex items-center justify-between gap-3 mb-3">
    <div class="text-sm opacity-75">Total: {{ filteredContracts().length }}</div>

    <p-iconfield iconPosition="left" class="min-w-[18rem]">
      <p-inputicon class="pi pi-search"></p-inputicon>
      <input
        type="text"
        pInputText
        placeholder="Search id, role, registration…"
        (input)="onQuery(getHtmlInputElement($event).value)"
      />
    </p-iconfield>
  </div>

  <!-- Contracts table -->
  <p-table
    [value]="pagedContracts()"
    [paginator]="true"
    [rows]="rowsPerPage()"
    [rowsPerPageOptions]="[10,25,50]"
    [totalRecords]="filteredContracts().length"
    [lazy]="true"
    (onPage)="onPage($event)"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first}–{last} of {totalRecords}"
    [tableStyle]="{ 'min-width': '48rem' }"
  >
    <ng-template #header>
      <tr>
        <th class="w-[34%]">Contract ID</th>
        <th class="w-[22%]">Role</th>
        <th>Registration Number</th>
      </tr>
    </ng-template>

    <ng-template #body let-row>
      <tr>
        <td class="break-words">{{ row.contractId }}</td>
        <td class="break-words">{{ row.role }}</td>
        <td class="break-words">{{ row.registrationNumber }}</td>
      </tr>
    </ng-template>
  </p-table>
}

