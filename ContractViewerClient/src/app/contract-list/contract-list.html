<!-- Toolbar (no search) -->
<div class="flex items-center justify-between gap-3 mb-3">
  <div class="text-sm opacity-75">Total: {{ allContracts().length }}</div>

  <div>
    <p-button text icon="pi pi-refresh" (onClick)="reload()"></p-button>
    <p-button text icon="pi pi-plus" (onClick)="generateContracts()"></p-button>
  </div>
</div>

@if (contracts.isLoading()) {
  <div class="flex items-center justify-center py-10">
    <p-progress-spinner aria-label="Loading contracts"></p-progress-spinner>
  </div>
} @else if (!contracts.hasValue()) {
  <div class="flex flex-col items-center gap-4 py-10">
    <p>Failed to fetch contracts</p>
  </div>
} @else {
  <!-- Contracts table (client-side paging by PrimeNG) -->
  <p-table
    [value]="allContracts()"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[10,25,50]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first}â€“{last} of {totalRecords}"
    [tableStyle]="{ 'min-width': '48rem' }"
  >
    <ng-template #header>
      <tr>
        <th class="w-[34%]">Contract ID</th>
        <th class="w-[22%]">Role</th>
        <th>Registration Number</th>
        <th class="w-[1%] text-right">Actions</th>
      </tr>
    </ng-template>

    <ng-template #body let-row>
      <tr>
        <td class="break-words">{{ row.contractId }}</td>
        <td class="break-words">{{ row.role }}</td>
        <td class="break-words">{{ row.registrationNumber }}</td>
        <td class="text-right">
          <p-button
            size="small"
            icon="pi pi-eye"
            label="Details"
            (onClick)="openDetails(row.contractId)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Details dialog -->
  <p-dialog
    header="Contract details"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [dismissableMask]="true"
    [breakpoints]="{ '1280px': '60vw', '960px': '75vw', '640px': '95vw' }"
    [style]="{ width: '70vw' }"
    appendTo="body"
    [visible]="detailsOpen()"
    (visibleChange)="detailsOpen.set($event)"
    (onHide)="detailsOpen.set(false)"
  >
    @if (selectedContractId()) {
      <div class="p-2 md:p-4">
        <app-contract-details [contractId]="selectedContractId()!"></app-contract-details>
      </div>
    } @else {
      <div class="p-6 text-center opacity-70">No contract selected.</div>
    }
  </p-dialog>
}
